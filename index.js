const agencies = [
  {
    agencyName: "Best Deal",
    cash: 1245000,
    credit: 200000,
    agencyId: "Plyq5M5AZ",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "3",
            year: 2015,
            price: 137000,
            carNumber: "AZJZ4",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "X6",
            year: 2020,
            price: 966500,
            carNumber: "S6DL1",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Land Cruiser",
            year: 2020,
            price: 336300,
            carNumber: "6rvXw",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Hilux",
            year: 2005,
            price: 35005,
            carNumber: "MWXBG",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Corolla",
            year: 2020,
            price: 111900,
            carNumber: "hCzl-",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "Ford",
        models: [
          {
            name: "Focus",
            year: 2020,
            price: 98200,
            carNumber: "kN3HP",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Focus",
            year: 2005,
            price: 6502,
            carNumber: "LJTCs",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "Alpha romeo",
        models: [
          {
            name: "Romeo Julia",
            year: 2020,
            price: 275406,
            carNumber: "2kjy7",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Romeo Stelvio",
            year: 2019,
            price: 215403,
            carNumber: "7A5b-",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Traverse",
            year: 2020,
            price: 201102,
            carNumber: "QwBOT",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Impala",
            year: 2019,
            price: 165041,
            carNumber: "2v4jt",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Malibu",
            year: 2017,
            price: 75405,
            carNumber: "O4_Jv",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
    ],
  },
  {
    agencyName: "CarMax",
    cash: 968541,
    credit: 500000,
    agencyId: "26_IPfHU1",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "X5",
            year: 2015,
            price: 218000,
            carNumber: "4Ixb0",
            ownerId: "26_IPfHU1",
          },
          {
            name: "X6",
            year: 2014,
            price: 97100,
            carNumber: "kAnv-",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Z4",
            year: 2019,
            price: 296900,
            carNumber: "ISMdU",
            ownerId: "26_IPfHU1",
          },
          {
            name: "3",
            year: 2010,
            price: 75100,
            carNumber: "9DJPw",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Land Cruiser",
            year: 2005,
            price: 80540,
            carNumber: "Kt-pW",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Corolla",
            year: 2019,
            price: 109100,
            carNumber: "YiYdI",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Hilux",
            year: 2019,
            price: 204000,
            carNumber: "DRmNw",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "Ford",
        models: [
          {
            name: "F250",
            year: 2020,
            price: 198500,
            carNumber: "g4Wfp",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Explorer",
            year: 2020,
            price: 265200,
            carNumber: "iNT8Q",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "Alpha romeo",
        models: [
          {
            name: "Spider",
            year: 2011,
            price: 75405,
            carNumber: "6t7QU",
            ownerId: "26_IPfHU1",
          },
          {
            name: "166",
            year: 2002,
            price: 12400,
            carNumber: "XMqpn",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Impala",
            year: 2016,
            price: 65042,
            carNumber: "vbeAo",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Savannah",
            year: 2016,
            price: 76505,
            carNumber: "WelWa",
            ownerId: "26_IPfHU1",
          },
        ],
      },
    ],
  },
  {
    agencyName: "The Auto World",
    cash: 687450,
    credit: 200000,
    agencyId: "gNHjNFL12",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "X6",
            year: 2018,
            price: 548100,
            carNumber: "EMW_7",
            ownerId: "gNHjNFL12",
          },
          {
            name: "3",
            year: 2017,
            price: 178000,
            carNumber: "XlnB4",
            ownerId: "gNHjNFL12",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Prius",
            year: 2017,
            price: 101542,
            carNumber: "-RQgN",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Highlander",
            year: 2017,
            price: 202540,
            carNumber: "AZJZ4",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Corolla",
            year: 1996,
            price: 5420,
            carNumber: "kHE8f",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Corolla",
            year: 2012,
            price: 40570,
            carNumber: "p2qEi",
            ownerId: "gNHjNFL12",
          },
        ],
      },
      {
        brand: "Ford",
        models: [
          {
            name: "Explorer",
            year: 2014,
            price: 127502,
            carNumber: "Ty1zN",
            ownerId: "gNHjNFL12",
          },
          {
            name: "F350",
            year: 2012,
            price: 54250,
            carNumber: "z03H2",
            ownerId: "gNHjNFL12",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Savannah",
            year: 2010,
            price: 36504,
            carNumber: "RXFZe",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Malibu",
            year: 2009,
            price: 19585,
            carNumber: "K5IsM",
            ownerId: "gNHjNFL12",
          },
        ],
      },
    ],
  },
  {
    agencyName: "Car Werks",
    cash: 302502,
    credit: 150000,
    agencyId: "9KeaYbRLP",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "8",
            year: 2020,
            price: 942500,
            carNumber: "4IUMz",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "X6",
            year: 2010,
            price: 129000,
            carNumber: "Vw0fV",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "X3",
            year: 2019,
            price: 358100,
            carNumber: "ufN54",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "3",
            year: 2020,
            price: 389100,
            carNumber: "F127X",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "3",
            year: 2002,
            price: 18400,
            carNumber: "ueZUp",
            ownerId: "9KeaYbRLP",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Prius",
            year: 2011,
            price: 38520,
            carNumber: "AZJZ4",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Land Cruiser",
            year: 2019,
            price: 290040,
            carNumber: "AZJZ4",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Hilux",
            year: 2020,
            price: 215700,
            carNumber: "xig8N",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Hilux",
            year: 2015,
            price: 178506,
            carNumber: "ghTiQ",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Corolla",
            year: 2002,
            price: 8504,
            carNumber: "Mvw8T",
            ownerId: "9KeaYbRLP",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Impala",
            year: 2005,
            price: 9320,
            carNumber: "BZpkt",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Malibu",
            year: 2002,
            price: 4502,
            carNumber: "KqKV_",
            ownerId: "9KeaYbRLP",
          },
        ],
      },
    ],
  },
  {
    agencyName: "Carsova",
    cash: 72450,
    credit: 50000,
    agencyId: "oqQmsZoUo",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "7",
            year: 1999,
            price: 24700,
            carNumber: "sZrjp",
            ownerId: "oqQmsZoUo",
          },
          {
            name: "3",
            year: 2008,
            price: 54000,
            carNumber: "da88K",
            ownerId: "oqQmsZoUo",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Prius",
            year: 2019,
            price: 124050,
            carNumber: "ZfbqH",
            ownerId: "oqQmsZoUo",
          },
          {
            name: "Hilux",
            year: 1996,
            price: 11540,
            carNumber: "AZJZ4",
            ownerId: "oqQmsZoUo",
          },
        ],
      },
    ],
  },
];
// getAgencyByName
// @param {string} - name
// @return {Object} - agency object
const carMarket = {
  agencies,
  getAgencyByName: function (name) {
    const searchagency = this.agencies.find(
      (agency) => agency.agencyName === name
    );
    return searchagency;
  },
  // getAgencyIdByName
  // @param {String} - name
  // @return {String} - agencyId
  getAgencyById: function (name) {
    const searchAgencyId = this.agencies.find(
      (agency) => agency.agencyName === name
    );
    return searchAgencyId ? searchAgencyId.agencyId : null;
  },
  // getAllAgenciesName
  // @return {string[]} - agenciesNameArr - Array of all agencies name
  getAllAgenciesName: function (name) {
    const agenciesNameArr = this.agencies.map((agency) => agency.agencyName);
    return agenciesNameArr;
  },

  // Add a new car to an agency's inventory.
  // @param {string} agencyId - The ID of the agency
  // @param {object} car - The car object to be added
  // @return {boolean} - true if added successfully, false otherwise
  addCarToAgency: function (agencyId, car) {
    if (!agencies.hasOwnProperty(agencyId)) {
      console.error(`Agency with ID ${agencyId} does not exist.`);
      return false;
    }
    agencies[agencyId].push(car);
    return true;
  },
  // Remove a car from an agency's inventory.
  // @param {string} agencyId - The ID of the agency
  // @param {string} carId - The ID of the car to be removed
  // @return {boolean} - true if removed successfully, false otherwise
  removeCarFromAgency: function (agencyId, carId) {
    if (!agencies.hasOwnProperty(agencyId)) {
      console.error(`Agency with ID ${agencyId} does not exist.`);
      return false;
    }
    const carIndex = agencies[agencyId].findIndex((car) => car.id === carId);
    if (carIndex !== -1) {
      agencies[agencyId].splice(carIndex, 1);
      return true;
    } else {
      console.error(
        `Car with ID ${carId} not found in the agency's inventory.`
      );
      return false;
    }
  },
  // Change the cash or credit of an agency.
  // @param {string} agencyId - The ID of the agency
  // @param {number} cashOrCredit - The amount of cash or credit to be updated
  // @return {boolean} - true if updated successfully, false otherwise
  changeAgencyCashOrCredit: function (agencyId, cashOrCredit) {
    if (!agencies.hasOwnProperty(agencyId)) {
      console.error(`Agency with ID ${agencyId} does not exist.`);
      return false;
    }
    const carIndex = agencies[agencyId].findIndex((car) => car.id === carId);
    if (carIndex !== -1) {
      agencies[agencyId].splice(carIndex, 1);
      return true;
    } else {
      console.error(
        `Car with ID ${carId} not found in the agency's inventory.`
      );
      return false;
    }
  },

  // Update the price of a specific car in an agency.
  // @param {string} agencyId - The ID of the agency
  // @param {string} carId - The ID of the car
  // @param {number} newPrice - The new price of the car
  // @return {boolean} - true if updated successfully, false otherwise
  updateCarPrice: function (agencyId, carId, newPrice) {
    if (!agencies.hasOwnProperty(agencyId)) {
      console.error(`Agency with ID ${agencyId} does not exist.`);
      return false;
    }
    const carToUpdate = agencies[agencyId].find((car) => car.id === carId);
    if (carToUpdate) {
      carToUpdate.price = newPrice;
      return true;
    } else {
      console.error(
        `Car with ID ${carId} not found in the agency's inventory.`
      );
      return false;
    }
  },
  // Calculate and return the total revenue for a specific agency.
  // @param {string} agencyId - The ID of the agency
  // @return {number} - The total revenue of the agency
  getTotalAgencyRevenue: function (agencyId) {
    if (!agencies.hasOwnProperty(agencyId)) {
      console.error(`Agency with ID ${agencyId} does not exist.`);
      return 0;
    }
    const agencyInventory = agencies[agencyId];
    let totalRevenue = 0;
    for (const car of agencyInventory) {
      const carRevenue = car.price * car.quantitySold;
      totalRevenue += carRevenue;
    }
    return totalRevenue;
  },
  // Transfer a car from one agency to another.
  // @param {string} fromAgencyId - The ID of the agency from where the car will be transferred
  // @param {string} toAgencyId - The ID of the agency to where the car will be transferred
  // @param {string} carId - The ID of the car to be transferred
  // @return {boolean} - true if transferred successfully, false otherwise
  transferCarBetweenAgencies: function (fromAgencyId, toAgencyId, carId) {
    if (
      !agencies.hasOwnProperty(fromAgencyId) ||
      !agencies.hasOwnProperty(toAgencyId)
    ) {
      console.error("Invalid agency ID(s).");
      return false;
    }
    const carIndex = agencies[fromAgencyId].findIndex(
      (car) => car.id === carId
    );
    if (carIndex !== -1) {
      const carToTransfer = agencies[fromAgencyId].splice(carIndex, 1)[0];
      agencies[toAgencyId].push(carToTransfer);
      return true;
    } else {
      console.error(
        `Car with ID ${carId} not found in the fromAgency's inventory.`
      );
      return false;
    }
  },
};

const CustomerManager = {
  customers: [],
  // Search for a customer by their name or ID.
  // @param {string} idOrName - ID or name of the customer
  // @return {object} - customer object if found, otherwise null
  searchCustomer: function (idOrName) {
    const customerById = this.customers.find(
      (customer) => customer.id === idOrName
    );
    const customerByName = this.customers.find(
      (customer) => customer.name === idOrName
    );
    return customerById || customerByName || null;
  },
  // Retrieve all customers' names.
  // @return {string[]} - Array of customer names
  getAllCustomers: function () {
    const customerNames = this.customers.map((customer) => customer.name);
    return customerNames;
  },

  // Change the cash of a customer.
  // @param {string} customerId - The ID of the customer
  // @param {number} cash - The new cash value
  // @return {boolean} - true if updated successfully, false otherwise
  changeCustomerCash: function (customerId, cash) {
    const customerIndex = this.customers.findIndex(
      (customer) => customer.id === customerId
    );
    if (customerIndex !== -1) {
      this.customers[customerIndex].cash = cash;
      return true;
    } else {
      console.error(`Customer with ID ${customerId} not found.`);
      return false;
    }
  },
  // Calculate the total value of all cars owned by a specific customer.
  // @param {string} customerId - The ID of the customer
  // @return {number} - The total value of cars owned by the customer
  getCustomerTotalCarValue: function (customerId) {
    const customer = this.customers.find(
      (customer) => customer.id === customerId
    );
    if (!customer) {
      console.error(`Customer with ID ${customerId} not found.`);
      return 0;
    }
    const { carsOwned } = customer;
    let totalCarValue = 0;
    for (const carId of carsOwned) {
      const car = this.cars[carId];
      if (car) {
        totalCarValue += car.price;
      }
    }
    return totalCarValue;
  },
};
const CarManager = {
  agencies: [],

  // Retrieve all cars available for purchase.
  // @return {object[]} - Array of cars
  getAllCars: function () {
    const allCars = [];
    for (const agency of this.agencies) {
      const agencyCars = agency.inventory;
      allCars.push(...agencyCars);
    }
    return allCars;
  },
  // Search for cars based on certain criteria.
  // @param {number} year - The production year of the car
  // @param {number} price - The price of the car
  // @param {string} brand - The brand of the car
  // @return {object[]} - Array of cars that meet the criteria
  searchCars: function (year, price, brand) {
    const matchingCars = [];
    for (const agency of this.agencies) {
      for (const car of agency.inventory) {
        if (
          (year === undefined || car.year === year) &&
          (price === undefined || car.price === price) &&
          (brand === undefined || car.make === brand)
        ) {
          matchingCars.push(car);
        }
      }
    }
    return matchingCars;
  },
  // Return the most expensive car available for sale.
  // @return {object} - The most expensive car
  getMostExpensiveCar: function () {
    let mostExpensiveCar = null;
    let maxPrice = 0;
    for (const agency of this.agencies) {
      for (const car of agency.inventory) {
        if (car.price > maxPrice) {
          maxPrice = car.price;
          mostExpensiveCar = car;
        }
      }
    }
    return mostExpensiveCar;
  },
  // Return the cheapest car available for sale.
  // @return {object} - The cheapest car
  getCheapestCar: function () {
    let cheapestCar = null;
    let minPrice = 0;
    for (const agency of this.agencies) {
      for (const car of agency.inventory) {
        if (car.price < minPrice) {
          minPrice = car.price;
          cheapestCar = car;
        }
      }
    }
    return cheapestCar;
  },
};
const CarPurchaseManager = {
  agencies: [],
  customers: [],
  taxesAuthority: {
    totalTaxesPaid: 0,
    sumOfAllTransactions: 0,
    numberOfTransactions: 0,
  },
  // Implement a sellCar function that sells a car to a specific customer.
  // @param {string} carId - The ID of the car
  // @param {string} customerId - The ID of the customer
  // @return {boolean} - true if the car was sold successfully, false otherwise
  sellCar: function (carId, customerId) {
    let carToSell = null;
    let sellingAgency = null;
    for (const agency of this.agencies) {
      const foundCar = agency.inventory.find((car) => car.carId === carId);
      if (foundCar) {
        carToSell = foundCar;
        sellingAgency = agency;
        break;
      }
    }
    if (!carToSell || !sellingAgency) {
      console.error(
        `Car with ID ${carId} not found in any agency's inventory.`
      );
      return false;
    }
    const customerBuyingCar = this.customers.find(
      (customer) => customer.customerId === customerId
    );
    if (!customerBuyingCar) {
      console.error(`Customer with ID ${customerId} not found.`);
      return false;
    }
    if (customerBuyingCar.cash < carToSell.price) {
      console.error(
        `Customer with ID ${customerId} does not have enough cash to purchase the car.`
      );
      return false;
    }
    const carIndex = sellingAgency.inventory.findIndex(
      (car) => car.carId === carId
    );
    if (carIndex !== -1) {
      sellingAgency.inventory.splice(carIndex, 1);
    } else {
      console.error(
        `Car with ID ${carId} not found in the selling agency's inventory.`
      );
      return false;
    }
    customerBuyingCar.cash -= carToSell.price;
    customerBuyingCar.carsOwned.push(carToSell);
    const taxes = carToSell.price * 0.1; // Assuming tax rate is 10%
    this.taxesAuthority.totalTaxesPaid += taxes;
    this.taxesAuthority.sumOfAllTransactions += carToSell.price;
    this.taxesAuthority.numberOfTransactions++;

    return true;
  },
  // Calculate and return the total revenue of the entire market.
  // @return {number} - The total revenue of the market
  getTotalMarketRevenue: function () {
    let totalRevenue = 0;
    for (const agency of this.agencies) {
      for (const car of agency.inventory) {
        totalRevenue += car.price;
      }
    }
    return totalRevenue;
  },
};
